<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi HTML5 Ad Viewer (CM360 Ready)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        #drop-zone {
            border: 2px dashed #007bff;
            padding: 20px;
            margin-bottom: 20px;
            cursor: pointer;
            color: #555;
        }
        #ads-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        iframe {
            border: 1px solid #ccc;
            display: block;
        }
    </style>
</head>
<body>
    <h1>Multi HTML5 Ad Viewer (CM360 Ready)</h1>
    <div id="drop-zone">Drop your ZIP files here (multiple supported)</div>
    <div id="ads-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        const dropZone = document.getElementById('drop-zone');
        const adsContainer = document.getElementById('ads-container');

        async function handleZip(zip, fileName) {
            const fileMap = {};

            // Extract all files and create Blob URLs
            for (const [filename, fileData] of Object.entries(zip.files)) {
                if (!fileData.dir) {
                    const blob = await fileData.async('blob');
                    const url = URL.createObjectURL(blob);
                    fileMap[filename] = url;
                }
            }

            // Locate the index.html file
            const indexFile = Object.keys(fileMap).find(name => name.endsWith('index.html'));
            if (indexFile) {
                const iframe = document.createElement('iframe');
                iframe.src = fileMap[indexFile]; // Point directly to the Blob URL
                iframe.onload = () => {
                    iframe.style.width = iframe.contentWindow.document.body.scrollWidth + 'px';
                    iframe.style.height = iframe.contentWindow.document.body.scrollHeight + 'px';
                };
                adsContainer.appendChild(iframe);
            } else {
                alert(`No index.html found in ZIP "${fileName}".`);
            }
        }

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#28a745';
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = '#007bff';
        });

        dropZone.addEventListener('drop', async (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#007bff';

            const files = Array.from(e.dataTransfer.files);
            adsContainer.innerHTML = ''; // Clear previous ads

            for (const file of files) {
                if (file.name.endsWith('.zip')) {
                    const zip = new JSZip();
                    await zip.loadAsync(file);
                    await handleZip(zip, file.name);
                } else {
                    alert(`"${file.name}" is not a ZIP file. Skipping.`);
                }
            }
        });
    </script>
</body>
</html>
